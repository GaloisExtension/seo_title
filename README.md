# TS-AI Keyword Research Tool

LLM と Python / Streamlit を活用して、検索キーワードの自動生成から各種メディアの記事調査、勝ちパターン分析までを一気通貫で行うアプリです。

---

## アプリ概要

AI を活用して SEO キーワードの発掘から記事ネタの立案までをワンストップで行えるリサーチツールです。検索ニーズと競合状況を同時に俯瞰できるため、初心者でも "今書くべきテーマ" をすぐに把握できます。

- キーワードを**自動生成**し、Google 検索結果や Qiita での人気度をワンクリックで取得
- AI がタイトルやハッシュタグの "勝ちパターン" を分析し、具体的な記事案を提案
- **Google Trends** スコアで需要の大きさを可視化
- CSV ダウンロードでチーム共有も簡単
- ログイン機能付きでクローズドな検証にも対応

---

## 機能概要

1. **キーワード自動生成**  
   ‑ テーマ・業界・技術キーワードを入力すると、OpenAI の LLM が多彩な検索キーワードを JSON で生成します。
2. **媒体別調査**  
   ‑ 生成したキーワードを Google / Qiita / Zenn / Note に対して検索し、記事数やタイトルを収集します。
3. **Google 検索件数取得 (3 段階フォールバック)**  
   ‑ SerpAPI → Google Custom Search JSON API → HTML スクレイピングの順で自動切替してヒット数を取得します。Custom Search 用の `GOOGLE_API_KEY` & `GOOGLE_CX` があれば高速・安定。
4. **Zenn / Note 取得強化**  
   ‑ Zenn は GraphQL `search` を使用し、失敗時は REST API にフォールバック。Note は公式 API が失敗した際に HTML スクレイピングで補完します。
5. **勝ちパターン分析**  
   ‑ 取得したデータを LLM で解析し、タイトルパターン / ハッシュタグ / ギャップテーマ / 記事アイデアを抽出。Pydantic バリデーションを緩和し、フォーマットに柔軟に対応。
6. **UX 改善**  
   ‑ キーワード生成後の表を常に表示。CSV ダウンロード後に消える問題を修正。
7. **CSV ダウンロード**  
   ‑ 生成したキーワードをワンクリックでエクスポート可能。

---

## セットアップ

```bash
# 1) 仮想環境 (任意)
python3 -m venv venv
source venv/bin/activate

# 2) 依存ライブラリ
pip install -r requirements.txt

# 3) OpenAI API キー
# いずれかの方法で設定してください
# A) 環境変数
export OPENAI_API_KEY="sk-..."

# B) Streamlit の secrets.toml
mkdir -p .streamlit
cat <<'TOML' > .streamlit/secrets.toml
OPENAI_API_KEY = "sk-..."
SERPAPI_KEY   = ""  # 任意
GOOGLE_API_KEY = ""  # Google Custom Search JSON API (任意)
GOOGLE_CX      = ""  # 検索エンジン ID (任意)
TOML

# 4) 実行
streamlit run app.py
```

---

## 使い方（3 ステップ）

1. **ログイン**  
   アプリ起動後に表示されるログイン画面で、ユーザー名とパスワードを入力します。デフォルトは

   - ユーザー名: `mellon`
   - パスワード: `pw`

2. **基本情報の入力**  
   サイドバーで「主題」「対象業界」「技術キーワード」を入力し、必要に応じて API キーを設定します。入力が終わったら「キーワード生成する」をクリック。

### 入力例

**主題**（何について調べたいか）

- 時系列分析
- 在庫最適化
- 発注自動化
- 需要予測
- 異常検知

**対象業界**（カンマ区切り）

- 製造業,小売業,物流業
- 金融,保険,不動産
- 医療,介護,福祉

**技術キーワード**（カンマ区切り）

- LLM,AI,機械学習
- 在庫管理,発注システム,SCM
- 時系列予測,ARIMA,LSTM

### 入力のコツ

- **主題**は具体的に。「AI」より「異常検知」の方が良いキーワードが生成されます
- **業界**は 3-5 個程度がベスト。多すぎるとキーワードが散漫になります
- **技術**は最新トレンドを意識。ChatGPT や Stable Diffusion など旬の技術も効果的

3. **リサーチ & 分析**  
   生成されたキーワード一覧から調査したいものを選択し、「検索を実行」。
   結果が表示されたら「勝ちパターン抽出」ボタンで AI による分析結果を確認できます。

---

## 特徴・メリット

- **初心者でも直感的**：フォーム入力とボタン操作だけでリサーチが完結。複雑なツールの使い方を覚える必要なし。
- **時短**：従来数時間かかっていたキーワード調査と競合分析を数分で実行。
- **AI ならではの提案力**：単なるデータ一覧ではなく、クリック率が高まりやすいタイトル型や未開拓のギャップ領域まで自動で提示。
- **データを持ち帰れる**：キーワード一覧を CSV で出力でき、そのまま施策リストとして共有可能。
- **クローズド運用**：ログインで利用者を制限できるため、社内検証やクライアント限定公開にも対応。

---

## トラブルシューティング

| 症状                                                    | 対応                                                                                                                       |
| ------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| `openai.OpenAIError: api_key client option must be set` | OPENAI_API_KEY が正しく設定されているか確認。サイドバーまたは環境変数・secrets.toml を使用してください。                   |
| `StreamlitSecretNotFoundError`                          | `.streamlit/secrets.toml` が存在しない場合に発生。ファイルを作成するか、環境変数で設定してください。                       |
| ネットワーク関連のタイムアウト                          | 社内プロキシや VPN が原因の場合があります。 `requests` の timeout 値を調整する、またはネットワーク状態を確認してください。 |

---

## ライセンス

MIT License
